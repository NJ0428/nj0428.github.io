---
layout: single
title: "스택 메모리 구조 동작 원리·오류 해결"
categories: Java
author_profile: false
toc: true
---

스택 메모리 구조(Stack Memory Structure)는 **자바 JVM**에서 메서드 호출을 처리하는 핵심 공간입니다. 스택을 이해하면 *재귀 최적화·메모리 오류 디버깅*에 한층 수월해집니다.

------

## 스택 메모리란?

- **스레드별로 독립**적으로 할당되는 고속 메모리입니다.
- **LIFO**(Last-In First-Out) 방식으로 동작하여, 마지막에 들어온 **스택 프레임**이 가장 먼저 제거됩니다.
- 크기는 `Xss` 옵션으로 고정하며, 한도를 넘으면 **StackOverflowError**가 발생합니다.

------

## 스택 프레임 상세 구조

| 영역                          | 설명                            |
| ----------------------------- | ------------------------------- |
| **매개변수(Parameter)**       | 호출 시 전달된 값 저장          |
| **지역 변수(Local Variable)** | 메서드 내부 선언 변수 저장      |
| **연산 스택(Operand Stack)**  | 산술‧논리 연산의 중간 결과 보관 |
| **리턴 주소(Return Address)** | 호출 종료 후 복귀 위치          |

> 참고
>
> 기본형은 *값 자체*, 참조형은 *힙 객체 주소*를 저장합니다.

------

## 스택 메모리 동작 플로우

1. **메서드 호출** → 새 스택 프레임이 스택 최상단에 푸시
2. **실행** → 매개변수·지역 변수·연산 스택 활용
3. **메서드 종료** → 프레임 팝(pop) & 리턴 값 상위 프레임으로 전달
4. **프로그램 종료** → 모든 프레임이 제거되어 스택이 빈 상태로 복귀

```java
public class StackExample {
    public static void main(String[] args) {
        int x = 10;                 // 스택에 저장
        int result = add(x, 20);    // add() 호출
        System.out.println(result);
    }
    public static int add(int a, int b) {
        int sum = a + b;            // 스택에 저장
        return sum;
    }
}
```

------

## 스택 메모리 오류와 해결 방법

| 오류                     | 원인                               | 해결책                               |
| ------------------------ | ---------------------------------- | ------------------------------------ |
| **StackOverflowError**   | 무한 재귀·과도한 호출 깊이         | 재귀 → 반복문 변경, `-Xss` 크기 조정 |
| **NullPointerException** | 스택 변수의 참조가 `null`인데 접근 | `null` 체크, Optional 활용           |

------

## 스택 vs 힙 메모리 비교

- **속도**: 스택 > 힙
- **관리 방식**: 스택은 *자동*, 힙은 *GC*
- **공유성**: 스택은 스레드 독립, 힙은 전역 공유
- **주요 오류**: StackOverflowError ↔ OutOfMemoryError

------

## 스택 메모리 최적화 실전 팁

- **재귀 깊이를 제한**하고 가능한 반복문으로 대체
- **지역 변수 범위**를 최소화해 프레임 크기를 줄이기
- 무거운 작업은 **메서드 분할**로 스택 부담 분산
- 스레드 수가 많을 때는 `Xss` 값을 **보수적으로** 설정하여 총 메모리 사용량 제어

------

## 질문 정리

1. **스택 크기를 늘리면 성능이 좋아지나요?**

   일정 이상은 성능에 큰 차이가 없으며, 오히려 총 메모리 사용량이 증가할 수 있습니다.

2. **스택 메모리는 GC 대상인가요?**

   아닙니다. 메서드 종료와 함께 자동 반환됩니다.

3. **StackOverflowError를 근본적으로 막을 방법이 있나요?**

   재귀 깊이를 제어하고, 큰 콜스택이 필요한 로직은 *반복문* 또는 *큐* 구조로 바꾸는 것이 최선입니다.

4. **스택 변수는 힙보다 빠른가요?**

   네. 메모리 접근 패턴이 간단하고 CPU 캐시 친화적이라 훨씬 빠릅니다.

5. **스레드마다 스택 크기를 다르게 설정할 수 있나요?**

   표준 JVM에서는 **불가능**합니다. 전체 프로세스에 하나의 `-Xss` 값이 적용됩니다.
